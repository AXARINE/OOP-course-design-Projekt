<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èŒåœºä¹±å›ç”Ÿå­˜æˆ˜ï¼šå·²è¯»ä¸å›çš„é™·é˜±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "å¾®è½¯é›…é»‘", Arial, sans-serif;
        }
        body {
            background-color: #f5f5f5;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .game-container {
            position: relative;
            border: 3px solid #333;
            background-color: #fff;
            width: 600px;
            height: 700px;
            overflow: hidden;
        }
        .score-panel {
            width: 600px;
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        .game-title {
            font-size: 24px;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .game-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 100;
        }
        .game-overlay h2 {
            font-size: 36px;
            margin-bottom: 20px;
        }
        .game-overlay p {
            font-size: 20px;
            margin-bottom: 30px;
            text-align: center;
            padding: 0 20px;
        }
        .btn {
            padding: 12px 30px;
            font-size: 18px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #2980b9;
        }
        .question-text {
            position: absolute;
            top: 20px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            padding: 0 10px;
            z-index: 10;
        }
        .pause-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 40px;
            font-weight: bold;
            color: #e74c3c;
            display: none;
            z-index: 90;
        }
        .red-hot-text {
            position: absolute;
            top: 50px;
            left: 0;
            width: 100%;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #e74c3c;
            z-index: 10;
            display: none;
        }
        /* æ–°å¢ï¼šé€Ÿåº¦æå‡æç¤º */
        .speed-up-tip {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 20px;
            background-color: #f39c12;
            color: white;
            font-size: 16px;
            font-weight: bold;
            border-radius: 4px;
            z-index: 20;
            display: none;
        }
    </style>
</head>
<body>
    <h1 class="game-title">èŒåœºä¹±å›ç”Ÿå­˜æˆ˜ï¼šå·²è¯»ä¸å›çš„é™·é˜±</h1>
    <div class="score-panel">
        <div>å¾—åˆ†: <span id="score">0</span></div>
        <div>é¢†å¯¼è¡€é‡: <span id="leaderHp">200</span>/200</div>
        <div>é¢†å¯¼æ€’æ°”: <span id="leaderAnger">0</span>/50</div>
    </div>
    <div class="game-container">
        <div class="question-text" id="question">ä¼šè®®æ—¶é—´æ”¹åˆ°å‡ ç‚¹ï¼Ÿ</div>
        <div class="red-hot-text" id="redHotText">é¢†å¯¼çº¢æ¸©ï¼å¿«å“„ï¼</div>
        <div class="pause-text" id="pauseText">æš‚åœä¸­</div>
        <!-- æ–°å¢ï¼šé€Ÿåº¦æå‡æç¤ºæ¡† -->
        <div class="speed-up-tip" id="speedUpTip">æ°”æ³¡é€Ÿåº¦æå‡ï¼</div>
        <canvas id="gameCanvas" width="600" height="700"></canvas>
        <div class="game-overlay" id="startScreen">
            <h2>èŒåœºä¹±å›ç”Ÿå­˜æˆ˜</h2>
            <p>è§„åˆ™ï¼šæ§åˆ¶å°äººç¢°æ’é”™è¯¯å›ç­”æ°”æ³¡ï¼ˆç°è‰²ï¼‰æ¶ˆè€—é¢†å¯¼è¡€é‡ï¼Œèº²é¿æ­£ç¡®å›ç­”æ°”æ³¡ï¼ˆè“è‰²ï¼‰<br>é¢†å¯¼çº¢æ¸©åï¼ˆæ€’æ°”â‰¥50ï¼‰èƒŒæ™¯å˜çº¢ï¼Œæ­£ç¡®æ°”æ³¡å˜å¤šï¼Œç¢°æ’ç»¿è‰²æ°”æ³¡å¯å‡æ€’<br>é¢†å¯¼è¡€é‡æ¯å‡å°‘25ç‚¹ï¼Œæ°”æ³¡é€Ÿåº¦åŠ å¿«ï¼<br>å·¦å³é”®ç§»åŠ¨ï¼ˆé•¿æŒ‰å¯è¿ç»­ç§»åŠ¨ï¼‰ï¼Œç©ºæ ¼é”®æš‚åœ/ç»§ç»­</p>
            <button class="btn" id="startBtn">å¼€å§‹æ¸¸æˆ</button>
        </div>
        <div class="game-overlay" id="gameOverScreen" style="display: none;">
            <h2 id="gameOverTitle">æ¸¸æˆç»“æŸï¼</h2>
            <p id="gameOverText">å·²è¯»ä¹±å›æˆåŠŸï¼ä½†ä¸‹æ¬¡é¢†å¯¼é—®ã€Œä½ ä¸ºä»€ä¹ˆä¹±å›ï¼Ÿã€ï¼Œä½ å›ä»€ä¹ˆï¼Ÿ</p>
            <p>æœ€ç»ˆå¾—åˆ†: <span id="finalScore">0</span></p>
            <button class="btn" id="restartBtn">é‡æ–°å¼€å§‹</button>
        </div>
    </div>

    <script>
        // ===================== æ ¸å¿ƒå¸¸é‡ =====================
        const CANVAS_WIDTH = 600;
        const CANVAS_HEIGHT = 700;
        const PLAYER_WIDTH = 50;
        const PLAYER_HEIGHT = 60;
        const BUBBLE_WIDTH = 120;
        const BUBBLE_HEIGHT = 40;
        const INITIAL_BUBBLE_SPEED = 2; // åˆå§‹æ°”æ³¡é€Ÿåº¦
        const SPEED_INCREMENT = 0.5; // æ¯æ¬¡æé€Ÿçš„å¢é‡
        const MAX_BUBBLE_SPEED = 8; // æ°”æ³¡é€Ÿåº¦ä¸Šé™
        const HP_CHECKPOINT_STEP = 20; // æ¯å‡å°‘20ç‚¹è¡€é‡æé€Ÿ
        const FIXED_PLAYER_SPEED = 8;
        const QUESTION_SWITCH_TIME = 8000;
        const TIP_DISPLAY_DURATION = 1500; // æç¤ºæ¡†æ˜¾ç¤ºæ—¶é•¿

        // ===================== Playerç±» =====================
        class Player {
            constructor() {
                this.x = CANVAS_WIDTH/2 - PLAYER_WIDTH/2;
                this.y = CANVAS_HEIGHT - PLAYER_HEIGHT - 10;
                this.width = PLAYER_WIDTH;
                this.height = PLAYER_HEIGHT;
                this.speed = FIXED_PLAYER_SPEED;
            }

            move(direction) {
                if (direction === 'left') {
                    this.x = Math.max(0, this.x - this.speed);
                } else if (direction === 'right') {
                    this.x = Math.min(CANVAS_WIDTH - this.width, this.x + this.speed);
                }
            }

            draw(ctx) {
                ctx.fillStyle = '#34495e';
                ctx.fillRect(this.x + 10, this.y, 30, 30);
                ctx.fillRect(this.x + 5, this.y + 30, 40, 20);
                ctx.strokeStyle = '#fff';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x + 15, this.y + 10, 8, 8);
                ctx.strokeRect(this.x + 27, this.y + 10, 8, 8);
            }

            reset() {
                this.x = CANVAS_WIDTH/2 - PLAYER_WIDTH/2;
            }
        }

        // ===================== Bubbleç±» =====================
        class Bubble {
            constructor(x, y, text, type) {
                this.x = x;
                this.y = y;
                this.width = BUBBLE_WIDTH;
                this.height = BUBBLE_HEIGHT;
                this.text = text;
                this.type = type;
            }

            update(speed) {
                this.y += speed;
            }

            draw(ctx) {
                let bgColor, borderColor, icon;
                switch(this.type) {
                    case 'correct':
                        bgColor = '#3498db';
                        borderColor = '#2980b9';
                        icon = '!';
                        break;
                    case 'wrong':
                        bgColor = '#95a5a6';
                        borderColor = '#7f8c8d';
                        icon = 'ğŸ˜œ';
                        break;
                    case 'angerReduce':
                        bgColor = '#2ecc71';
                        borderColor = '#27ae60';
                        icon = 'ğŸ‘';
                        break;
                }

                ctx.fillStyle = bgColor;
                ctx.fillRect(this.x, this.y, this.width, this.height);
                ctx.strokeStyle = borderColor;
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x, this.y, this.width, this.height);

                ctx.fillStyle = '#fff';
                ctx.font = '16px å¾®è½¯é›…é»‘';
                ctx.textAlign = 'left';
                ctx.textBaseline = 'middle';
                ctx.fillText(icon, this.x + 10, this.y + this.height/2);

                ctx.textAlign = 'center';
                ctx.font = '12px å¾®è½¯é›…é»‘';
                const showText = this.text.length > 12 ? this.text.substring(0, 10) + '...' : this.text;
                ctx.fillText(showText, this.x + this.width/2, this.y + this.height/2);
            }
        }

        // ===================== Gameç±» =====================
        class Game {
            constructor() {
                // åŸºç¡€å±æ€§åˆå§‹åŒ–
                this.canvas = document.getElementById('gameCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.player = new Player();
                this.bubbles = [];
                this.score = 0;
                this.bubbleSpeed = INITIAL_BUBBLE_SPEED; // åˆå§‹é€Ÿåº¦
                this.gameRunning = false;
                this.gamePaused = false;
                this.gameOver = false;
                this.keys = { ArrowLeft: false, ArrowRight: false };

                // é¢†å¯¼å±æ€§
                this.leader = {
                    hp: 200,
                    maxHp: 200,
                    anger: 0,
                    maxAnger: 50,
                    isRedHot: false
                };

                // æ–°å¢ï¼šè¡€é‡æ£€æŸ¥ç‚¹ï¼ˆç”¨äºåˆ¤æ–­æ˜¯å¦æé€Ÿï¼‰
                this.lastHpCheckpoint = this.leader.maxHp; // åˆå§‹ä¸º200

                // é—®é¢˜æ•°æ®
                this.questionData = [
                    { question: "ä¼šè®®æ—¶é—´æ”¹åˆ°å‡ ç‚¹ï¼Ÿ", correct: "æ”¹åˆ°ä¸‹åˆ2ç‚¹ï¼Œè®°å¾—å‡†æ—¶ã€‚", wrong: ["å“¦ï¼ŒçŸ¥é“äº†ã€‚", "ç­‰æˆ‘çœ‹çœ‹ã€‚"] },
                    { question: "ä¸ºä»€ä¹ˆé¡¹ç›®å»¶æœŸï¼Ÿ", correct: "å› å®¢æˆ·éœ€æ±‚å˜æ›´ï¼Œå·²åè°ƒèµ„æºã€‚", wrong: ["å¯èƒ½å§ã€‚", "æ²¡æ³¨æ„æ—¶é—´ã€‚"] },
                    { question: "é¢„ç®—å®¡æ‰¹é€šè¿‡äº†å—ï¼Ÿ", correct: "å·²é€šè¿‡ï¼Œä¸‹å‘¨å‘æ”¾ã€‚", wrong: ["åº”è¯¥å¯ä»¥å§ã€‚", "ç­‰é€šçŸ¥ã€‚"] },
                    { question: "ä½ è¿Ÿåˆ°åŸå› ï¼Ÿ", correct: "åœ°é“æ•…éšœï¼Œå·²ç”³è¯·è¡¥å‡ã€‚", wrong: ["æ²¡ç¡é†’ã€‚", "è·¯ä¸Šå µè½¦ã€‚"] },
                    { question: "è¯·ç¡®è®¤é‚®ä»¶å†…å®¹ï¼Ÿ", correct: "å·²é˜…è¯»ï¼ŒæŒ‰è¦æ±‚å¤„ç†ã€‚", wrong: ["æ”¶åˆ°ã€‚", "å—¯ã€‚"] },
                    { question: "é¢†å¯¼é—®ï¼šè¿™ä¸ªæ–¹æ¡ˆè¡Œå—ï¼Ÿ", correct: "æ–¹æ¡ˆå·²ä¼˜åŒ–ï¼Œå¯æ‰§è¡Œã€‚", wrong: ["è¿˜è¡Œå§ã€‚", "ä½ å®šã€‚"] },
                    { question: "ä¼šè®®çºªè¦å‘äº†å—ï¼Ÿ", correct: "å·²å‘é€è‡³ç¾¤å†…ï¼Œé™„ä»¶è§ã€‚", wrong: ["å‘äº†ã€‚", "åœ¨ç¾¤é‡Œã€‚"] },
                    { question: "å®¢æˆ·æŠ•è¯‰å¦‚ä½•å¤„ç†ï¼Ÿ", correct: "å·²è”ç³»å®¢æˆ·é“æ­‰å¹¶è¡¥å¿ã€‚", wrong: ["çŸ¥é“äº†ã€‚", "å…ˆæ”¾æ”¾ã€‚"] },
                    { question: "è·¨éƒ¨é—¨åä½œè¿›åº¦ï¼Ÿ", correct: "Aéƒ¨é—¨å·²å®Œæˆï¼ŒBéƒ¨é—¨å¾…ç¡®è®¤ã€‚", wrong: ["åœ¨å¼„ã€‚", "å¿«äº†ã€‚"] },
                    { question: "ç³»ç»Ÿæ•…éšœåŸå› ï¼Ÿ", correct: "å› æœåŠ¡å™¨å‡çº§å¯¼è‡´ï¼Œå·²ä¿®å¤ã€‚", wrong: ["å¯èƒ½å¡äº†ã€‚", "æ²¡ç®¡ã€‚"] }
                ];
                this.currentQuestion = this.questionData[0];
                this.questionTimer = null;

                // ç»¿è‰²æ°”æ³¡ç›¸å…³
                this.greenBubbleTypes = ["æ‹é©¬å±", "è¯·é¢†å¯¼åƒé¥­", "å¤¸å¤¸"];
                this.lastGreenBubbleScore = 0;

                // ç»‘å®šäº‹ä»¶+åˆå§‹åŒ–UI
                this.bindEvents();
                this.initUI();
            }

            // åˆå§‹åŒ–UI
            initUI() {
                document.getElementById('score').textContent = this.score;
                document.getElementById('leaderHp').textContent = this.leader.hp;
                document.getElementById('leaderAnger').textContent = this.leader.anger;
                document.getElementById('question').textContent = this.currentQuestion.question;
            }

            // ç»‘å®šäº‹ä»¶
            bindEvents() {
                document.addEventListener('keydown', (e) => {
                    if (e.key in this.keys) {
                        this.keys[e.key] = true;
                        e.preventDefault();
                    }
                    if (!this.gameRunning || this.gameOver) return;
                    if (e.key === ' ') {
                        this.gamePaused = !this.gamePaused;
                        document.getElementById('pauseText').style.display = this.gamePaused ? 'block' : 'none';
                        if (this.gamePaused) {
                            clearInterval(this.questionTimer);
                        } else {
                            this.startQuestionTimer();
                        }
                    }
                });

                document.addEventListener('keyup', (e) => {
                    if (e.key in this.keys) {
                        this.keys[e.key] = false;
                        e.preventDefault();
                    }
                });

                window.addEventListener('blur', () => {
                    this.keys.ArrowLeft = false;
                    this.keys.ArrowRight = false;
                });

                const startBtn = document.getElementById('startBtn');
                if (startBtn) {
                    startBtn.addEventListener('click', () => {
                        this.startGame();
                    });
                }

                const restartBtn = document.getElementById('restartBtn');
                if (restartBtn) {
                    restartBtn.addEventListener('click', () => {
                        this.restartGame();
                    });
                }
            }

            // éšæœºåˆ‡æ¢é—®é¢˜
            switchRandomQuestion() {
                const randomIndex = Math.floor(Math.random() * this.questionData.length);
                this.currentQuestion = this.questionData[randomIndex];
                document.getElementById('question').textContent = this.currentQuestion.question;
            }

            // å¯åŠ¨é—®é¢˜å®šæ—¶å™¨
            startQuestionTimer() {
                clearInterval(this.questionTimer);
                this.questionTimer = setInterval(() => {
                    if (this.gameRunning && !this.gamePaused) {
                        this.switchRandomQuestion();
                    }
                }, QUESTION_SWITCH_TIME);
            }

            // æ–°å¢ï¼šæ˜¾ç¤ºé€Ÿåº¦æå‡æç¤º
            showSpeedUpTip() {
                const tip = document.getElementById('speedUpTip');
                tip.style.display = 'block';
                setTimeout(() => {
                    tip.style.display = 'none';
                }, TIP_DISPLAY_DURATION);
            }

            // æ–°å¢ï¼šæ£€æŸ¥è¡€é‡å¹¶æå‡æ°”æ³¡é€Ÿåº¦
            checkHpAndSpeedUp() {
                // è®¡ç®—å½“å‰è¡€é‡ä¸ä¸Šä¸€ä¸ªæ£€æŸ¥ç‚¹çš„å·®å€¼
                const hpDiff = this.lastHpCheckpoint - this.leader.hp;
                // å·®å€¼â‰¥25ç‚¹ ä¸” æœªè¾¾åˆ°é€Ÿåº¦ä¸Šé™
                if (hpDiff >= HP_CHECKPOINT_STEP && this.bubbleSpeed < MAX_BUBBLE_SPEED) {
                    this.bubbleSpeed += SPEED_INCREMENT;
                    // é™åˆ¶é€Ÿåº¦ä¸è¶…è¿‡ä¸Šé™
                    this.bubbleSpeed = Math.min(this.bubbleSpeed, MAX_BUBBLE_SPEED);
                    // æ›´æ–°æ£€æŸ¥ç‚¹ä¸ºå½“å‰è¡€é‡
                    this.lastHpCheckpoint = this.leader.hp;
                    // æ˜¾ç¤ºæé€Ÿæç¤º
                    this.showSpeedUpTip();
                }
            }

            // å¤„ç†ç©å®¶ç§»åŠ¨
            handlePlayerMovement() {
                if (this.gamePaused || !this.gameRunning || this.gameOver) return;
                if (this.keys.ArrowLeft) this.player.move('left');
                if (this.keys.ArrowRight) this.player.move('right');
            }

            // çº¢æ¸©çŠ¶æ€åˆ‡æ¢
            enterRedHot() {
                this.leader.isRedHot = true;
                document.querySelector('.game-container').style.backgroundColor = '#ffebeb';
                document.getElementById('redHotText').style.display = 'block';
            }
            exitRedHot() {
                this.leader.isRedHot = false;
                document.querySelector('.game-container').style.backgroundColor = '#fff';
                document.getElementById('redHotText').style.display = 'none';
            }

            // å¼€å§‹æ¸¸æˆ
            startGame() {
                try {
                    document.getElementById('startScreen').style.display = 'none';
                    this.gameRunning = true;
                    this.gameOver = false;
                    this.gamePaused = false;
                    document.getElementById('pauseText').style.display = 'none';
                    this.keys.ArrowLeft = false;
                    this.keys.ArrowRight = false;

                    this.startQuestionTimer();
                    this.gameLoop();
                } catch (e) {
                    console.error('å¼€å§‹æ¸¸æˆå‡ºé”™ï¼š', e);
                }
            }

            // é‡æ–°å¼€å§‹æ¸¸æˆ
            restartGame() {
                // é‡ç½®æ‰€æœ‰çŠ¶æ€
                this.player.reset();
                this.bubbles = [];
                this.score = 0;
                // é‡ç½®æ°”æ³¡é€Ÿåº¦å’Œæ£€æŸ¥ç‚¹
                this.bubbleSpeed = INITIAL_BUBBLE_SPEED;
                this.lastHpCheckpoint = this.leader.maxHp;
                this.gameOver = false;
                this.gameRunning = true;
                this.gamePaused = false;
                this.keys = { ArrowLeft: false, ArrowRight: false };

                // é‡ç½®é¢†å¯¼çŠ¶æ€
                this.leader.hp = 200;
                this.leader.anger = 0;
                this.leader.isRedHot = false;
                this.exitRedHot();

                // é‡ç½®ç»¿è‰²æ°”æ³¡å’Œé—®é¢˜
                this.lastGreenBubbleScore = 0;
                this.switchRandomQuestion();

                // æ›´æ–°UI
                document.getElementById('score').textContent = this.score;
                document.getElementById('leaderHp').textContent = this.leader.hp;
                document.getElementById('leaderAnger').textContent = this.leader.anger;
                document.getElementById('gameOverScreen').style.display = 'none';
                document.getElementById('gameOverTitle').textContent = 'æ¸¸æˆç»“æŸï¼';

                // é‡å¯å®šæ—¶å™¨å’Œå¾ªç¯
                this.startQuestionTimer();
                this.gameLoop();
            }

            // ç”Ÿæˆæ°”æ³¡
            generateBubble() {
                if (this.gamePaused || !this.gameRunning) return;
                
                // ç”Ÿæˆæ­£ç¡®/é”™è¯¯æ°”æ³¡
                if (Math.random() < 0.017 && this.bubbles.length < 5) {
                    const isCorrect = Math.random() < (this.leader.isRedHot ? 0.5 : 0.3);
                    let text, type;
                    if (isCorrect) {
                        text = this.currentQuestion.correct;
                        type = 'correct';
                    } else {
                        text = this.currentQuestion.wrong[Math.floor(Math.random() * this.currentQuestion.wrong.length)];
                        type = 'wrong';
                    }
                    const x = Math.random() * (CANVAS_WIDTH - BUBBLE_WIDTH);
                    this.bubbles.push(new Bubble(x, -BUBBLE_HEIGHT, text, type));
                }
                
                // ç»¿è‰²å‡æ€’æ°”æ³¡
                if (this.leader.isRedHot && this.score - this.lastGreenBubbleScore >= 500) {
                    const randomText = this.greenBubbleTypes[Math.floor(Math.random() * this.greenBubbleTypes.length)];
                    const x = Math.random() * (CANVAS_WIDTH - BUBBLE_WIDTH);
                    this.bubbles.push(new Bubble(x, -BUBBLE_HEIGHT, randomText, 'angerReduce'));
                    this.lastGreenBubbleScore = this.score;
                }
            }

            // æ›´æ–°æ°”æ³¡å’Œç¢°æ’æ£€æµ‹
            updateBubbles() {
                for (let i = this.bubbles.length - 1; i >= 0; i--) {
                    const bubble = this.bubbles[i];
                    bubble.update(this.bubbleSpeed);

                    if (this.checkCollision(this.player, bubble)) {
                        switch(bubble.type) {
                            case 'correct':
                                this.gameOver = true;
                                this.gameRunning = false;
                                clearInterval(this.questionTimer);
                                document.getElementById('gameOverTitle').textContent = 'æ¸¸æˆç»“æŸï¼';
                                document.getElementById('gameOverText').textContent = 'å›ç­”å¤ªè®¤çœŸï¼Œè¢«é¢†å¯¼å§”ä»¥é‡ä»»ï¼';
                                document.getElementById('finalScore').textContent = this.score;
                                document.getElementById('gameOverScreen').style.display = 'flex';
                                break;
                            case 'wrong':
                                this.score += 100;
                                document.getElementById('score').textContent = this.score;
                                if (this.leader.isRedHot) {
                                    this.leader.hp = Math.max(0, this.leader.hp - 1);
                                } else {
                                    this.leader.hp = Math.max(0, this.leader.hp - 5);
                                    this.leader.anger = Math.min(this.leader.maxAnger, this.leader.anger + 5);
                                    if (this.leader.anger >= this.leader.maxAnger) {
                                        this.enterRedHot();
                                    }
                                }
                                document.getElementById('leaderHp').textContent = this.leader.hp;
                                document.getElementById('leaderAnger').textContent = this.leader.anger;

                                // å…³é”®ä¿®æ”¹ï¼šæ¯æ¬¡æ‰£è¡€åæ£€æŸ¥æ˜¯å¦éœ€è¦æé€Ÿ
                                this.checkHpAndSpeedUp();

                                if (this.leader.hp <= 0) {
                                    this.gameWin();
                                }
                                this.bubbles.splice(i, 1);
                                break;
                            case 'angerReduce':
                                this.leader.anger = Math.max(0, this.leader.anger - 10);
                                document.getElementById('leaderAnger').textContent = this.leader.anger;
                                if (this.leader.anger <= 0 && this.leader.isRedHot) {
                                    this.exitRedHot();
                                }
                                this.bubbles.splice(i, 1);
                                break;
                        }
                    }

                    if (bubble.y > CANVAS_HEIGHT) {
                        this.bubbles.splice(i, 1);
                    }
                }
            }

            // ç¢°æ’æ£€æµ‹
            checkCollision(rect1, rect2) {
                return rect1.x < rect2.x + rect2.width &&
                       rect1.x + rect1.width > rect2.x &&
                       rect1.y < rect2.y + rect2.height &&
                       rect1.y + rect1.height > rect2.y;
            }

            // æ¸¸æˆèƒœåˆ©
            gameWin() {
                this.gameRunning = false;
                clearInterval(this.questionTimer);
                document.getElementById('gameOverTitle').textContent = 'æ¸¸æˆèƒœåˆ©ï¼';
                document.getElementById('gameOverText').textContent = 'æ­å–œï¼æˆåŠŸç³Šå¼„é¢†å¯¼ï¼Œè·å¾—æ‘¸é±¼è‡ªç”±ï¼';
                document.getElementById('finalScore').textContent = this.score;
                document.getElementById('gameOverScreen').style.display = 'flex';
            }

            // æ¸…ç©ºç”»å¸ƒ
            clearCanvas() {
                this.ctx.fillStyle = '#ecf0f1';
                this.ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
            }

            // æ¸¸æˆä¸»å¾ªç¯
            gameLoop() {
                if (!this.gameRunning) return;
                if (this.gamePaused) {
                    requestAnimationFrame(() => this.gameLoop());
                    return;
                }

                this.handlePlayerMovement();
                this.clearCanvas();
                this.generateBubble();
                this.updateBubbles();
                this.player.draw(this.ctx);
                this.bubbles.forEach(bubble => bubble.draw(this.ctx));

                requestAnimationFrame(() => this.gameLoop());
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        window.addEventListener('load', () => {
            new Game();
        });
    </script>
</body>
</html>