# ðŸŽ® ç§å­çº¦æŸéšæœºåå¼¹åœ°å›¾ç®—æ³•æ–‡æ¡£

## æ¦‚è¿°

å®žçŽ°äº†"**Seeded Constrained Ricochet Map**"ç®—æ³•ï¼Œä¸€ä¸ªè½»é‡çº§çš„JSæ¸¸æˆåœ°å›¾ç”Ÿæˆå™¨ï¼Œç‰¹åˆ«ä¼˜åŒ–äº†å­å¼¹åå¼¹æ¸¸æˆçš„åœ°å›¾å¹³è¡¡æ€§å’Œè¶£å‘³æ€§ã€‚

## æ ¸å¿ƒç‰¹æ€§

### â‘  ç§å­ç³»ç»Ÿï¼ˆReproducible Mapsï¼‰
- **æ¯å±€ä¸€ä¸ªç§å­** - å®Œå…¨ç¡®å®šæ€§åœ°å›¾ç”Ÿæˆ
- **ç§å­å¯å¤çŽ°** - åŒç§å­ = åŒåœ°å›¾ï¼ˆä¾¿äºŽè°ƒè¯•å’Œåˆ†äº«å¥½åœ°å›¾ï¼‰
- **SeededRandom ç±»** - Mulberry32 ç®—æ³•å®žçŽ°

```typescript
const rng = new SeededRandom(12345); // å›ºå®šç§å­
const randomNum = rng.next();        // 0.0 ~ 1.0
const randInt = rng.nextInt(1, 10);  // 1 ~ 9
```

### â‘¡ çŸ­å¢™æ¨¡å—ç”Ÿæˆï¼ˆSmart Wall Placementï¼‰
- **ä¸æ˜¯ä¸€æ ¼ä¸€æ ¼æ”¾å¢™**ï¼Œè€Œæ˜¯ç”Ÿæˆ **2~5 æ ¼çš„çŸ­å¢™æ®µ**
- **æ–¹å‘**: æ°´å¹³ / ç«–ç›´
- **ä¼˜ç‚¹**:
  - âœ… çŸ­å¢™åˆ©äºŽåå¼¹ï¼ˆå¼¹æ€§åœ°å½¢ï¼‰
  - âœ… é¿å…"é•¿å¢™ç§’æ€"çš„ä¸å…¬å¹³
  - âœ… è§†è§‰ä¸Šæ›´è‡ªç„¶

### â‘¢ å±€éƒ¨å¯†åº¦é™åˆ¶ï¼ˆRegion Balancingï¼‰
- **åœ°å›¾åˆ†å—**: å°†åœ°å›¾åˆ†æˆ NÃ—N åŒºå—ï¼ˆé»˜è®¤ 64Ã—64 åƒç´ ï¼‰
- **æ¯å—çº¦æŸ**: å¢™ä½“æ•°é‡å¿…é¡»åœ¨ `[minWalls, maxWalls]` èŒƒå›´å†…
- **è¶…æ ‡å›žæ»š**: è¶…è¿‡ä¸Šé™çš„å¢™ä½“æ®µä¼šè¢«åˆ é™¤
- **æ•ˆæžœ**: é˜²æ­¢ä¸€è¾¹"åœ°ç‹±åœ°å½¢"ã€ä¸€è¾¹"ç©ºåœ°"çš„ä¸å¹³è¡¡

### â‘£ åå¼¹è¦†ç›–æ£€æµ‹ï¼ˆCoverage Validationï¼‰
- **ä»Žæ¯ä¸ªå‡ºç”Ÿç‚¹å‘å°„å°„çº¿**ï¼ˆ16~32 æ¡ï¼‰
- **è¿½è¸ªåå¼¹** - æ¯æ¡å°„çº¿æœ€å¤šåå¼¹ 3~5 æ¬¡
- **è®¡ç®—è¦†ç›–çŽ‡** - èƒ½åˆ°è¾¾çš„æ ¼å­æ•° / æ€»æ ¼å­æ•°
- **æ£€éªŒæ¡ä»¶**:
  ```
  å¹³å‡è¦†ç›–çŽ‡ â‰¥ 60%
  å„å‡ºç”Ÿç‚¹é—´å·®å¼‚ â‰¤ 10%
  ```
- **ç›®æ ‡**: ä¿è¯æ‰€æœ‰å‡ºç”Ÿç‚¹éƒ½æœ‰å…¬å¹³çš„æ´»åŠ¨ç©ºé—´

### â‘¤ ç›´çº¿ç§’æ€æ¶ˆé™¤ï¼ˆSmart Blockingï¼‰
- **æ£€æµ‹å‡ºç”Ÿç‚¹é—´ç›´çº¿è·¯å¾„** - æ— é˜»æŒ¡ = å¯ç›´çº¿å°„å‡»
- **è‡ªåŠ¨æ’å¢™** - åœ¨ä¸­é—´éšæœºä½ç½®æ”¾ç½®çŸ­å¢™
- **è¿­ä»£éªŒè¯** - å†æ¬¡è·‘è¦†ç›–æ£€æµ‹ç¡®è®¤å¹³è¡¡
- **å…³é”®ç‚¹**: è¿™æ˜¯"çœ‹èµ·æ¥éšæœºä½†ä¸æ¶å¿ƒ"çš„åŸºç¡€

## æ–‡ä»¶ç»“æž„

```
src/utils/
â”œâ”€â”€ SeededRandom.ts          # ç§å­éšæœºç”Ÿæˆå™¨
â””â”€â”€ RicochetMapGenerator.ts  # åœ°å›¾ç”Ÿæˆå™¨æ ¸å¿ƒ

src/managers/
â””â”€â”€ MapManager.ts            # é›†æˆæ–°ç®—æ³•
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ä½¿ç”¨
```typescript
// åœ¨ GameScene ä¸­
const mapManager = new MapManager(scene);

// ä½¿ç”¨æ–°çš„ Ricochet ç®—æ³•ç”Ÿæˆåœ°å›¾
// å¦‚æžœä¸æŒ‡å®š seedï¼Œä¼šéšæœºç”Ÿæˆä¸€ä¸ª
mapManager.createMap(playerX, playerY);

// æŸ¥çœ‹ç”Ÿæˆçš„ç§å­
const seed = mapManager.getLastSeed();
console.log(`Map seed: ${seed}`);
```

### å›ºå®šç§å­ï¼ˆè°ƒè¯•æˆ–åˆ†äº«åœ°å›¾ï¼‰
```typescript
// å›ºå®šç§å­ç”Ÿæˆç‰¹å®šåœ°å›¾
mapManager.createMap(playerX, playerY, 'wall-texture', 42);
// ä»»ä½•æ—¶åˆ»ç”¨ seed=42 éƒ½ä¼šç”Ÿæˆå®Œå…¨ç›¸åŒçš„åœ°å›¾
```

### æ˜¾ç¤ºç§å­ä¿¡æ¯
```typescript
// åœ¨ UIManager ä¸­
uiManager.showSeed(seed);
// å³ä¸Šè§’æ˜¾ç¤º: "Seed: 42"
```

## ç®—æ³•æµç¨‹ï¼ˆè¯¦ç»†ï¼‰

### æ­¥éª¤ 1: åˆå§‹åŒ–
```
è¾“å…¥: MapConfig {
  width: 800, height: 600,
  tileSize: 32,
  seed: 12345,
  targetWallDensity: 0.10 (10%),
  spawnPoints: [...]
}
â†“
åˆ›å»º SeededRandom(seed)
åˆ›å»ºç½‘æ ¼ (25Ã—19 æ ¼å­)
åˆ›å»º 4Ã—4 åŒºå—ç»“æž„
```

### æ­¥éª¤ 2: ç”Ÿæˆå¢™æ¨¡å—
```
å¾ªçŽ¯ç”ŸæˆçŸ­å¢™æ®µ:
  â”œâ”€ éšæœºæ–¹å‘ (h/v)
  â”œâ”€ éšæœºé•¿åº¦ (2-5 æ ¼)
  â”œâ”€ éšæœºä½ç½®
  â””â”€ æ£€æŸ¥:
      â”œâ”€ æ˜¯å¦ä¸Žå‡ºç”Ÿç‚¹å¤ªè¿‘? â†’ æ‹’ç»
      â”œâ”€ æ˜¯å¦ä¸ŽçŽ°æœ‰å¢™ç¢°æ’ž? â†’ æ‹’ç»
      â””â”€ æ˜¯å¦è¶…è¿‡ç›®æ ‡å¯†åº¦? â†’ åœæ­¢

ç»“æžœ: ~30-50 ä¸ªå¢™æ®µ
```

### æ­¥éª¤ 3: å¯†åº¦çº¦æŸ
```
å¯¹æ¯ä¸ª 4Ã—4 åŒºå—:
  â”œâ”€ ç»Ÿè®¡è¯¥åŒºå—çš„å¢™æ•°
  â”œâ”€ è¶…è¿‡ maxWalls? â†’ ç§»é™¤å¤šä½™æ®µ
  â””â”€ ä½ŽäºŽ minWalls? â†’ è®°å½•ï¼ˆå¯é€‰åŠ å¼ºï¼‰

æ•ˆæžœ: åœ°å›¾å¯†åº¦åˆ†å¸ƒæ›´å‡åŒ€
```

### æ­¥éª¤ 4: åå¼¹è¦†ç›–éªŒè¯
```
å¯¹æ¯ä¸ªå‡ºç”Ÿç‚¹:
  â”œâ”€ å‘å°„ 24 æ¡å°„çº¿ï¼ˆæ¯ 15Â° ä¸€æ¡ï¼‰
  â”œâ”€ è¿½è¸ªæ¯æ¡å°„çº¿çš„åå¼¹è¿‡ç¨‹:
  â”‚   â”œâ”€ ä»Žå‡ºç”Ÿç‚¹å‡ºå‘
  â”‚   â”œâ”€ æ£€æµ‹ä¸Žå¢™ç¢°æ’ž
  â”‚   â”œâ”€ è®¡ç®—åå°„å‘é‡
  â”‚   â””â”€ ç»§ç»­å‰è¿›ï¼ˆæœ€å¤š 4 æ¬¡åå¼¹ï¼‰
  â”œâ”€ è®°å½•æ‰€æœ‰è¦†ç›–æ ¼å­
  â””â”€ è®¡ç®—è¦†ç›–çŽ‡ = covered_cells / total_cells

æ£€éªŒæ¡ä»¶:
  â”œâ”€ å¹³å‡è¦†ç›–çŽ‡ >= 60%?
  â””â”€ max_coverage - min_coverage <= 10%?

è¾“å‡º: è¦†ç›–çŽ‡æŠ¥å‘Š
```

### æ­¥éª¤ 5: æ¶ˆé™¤ç›´çº¿ç§’æ€
```
å¯¹æ¯å¯¹å‡ºç”Ÿç‚¹ (P1, P2):
  â”œâ”€ æ£€æµ‹ P1 â†’ P2 çš„ç›´çº¿è·¯å¾„
  â”œâ”€ æ˜¯å¦æœ‰å¢™é˜»æŒ¡?
  â”‚   â””â”€ æ—  = å¯ç›´çº¿å°„å‡»ï¼ˆåï¼‰
  â”œâ”€ åœ¨ä¸­ç‚¹é™„è¿‘éšæœºä½ç½®æ’å…¥çŸ­å¢™
  â”œâ”€ å†éªŒè¯ä¸€æ¬¡è¦†ç›–çŽ‡
  â””â”€ ç»§ç»­

ç»“æžœ: æ¶ˆé™¤æ‰€æœ‰å¯èƒ½çš„ç›´çº¿ç§’æ€è·¯çº¿
```

## æ€§èƒ½æŒ‡æ ‡

| é¡¹ç›®            | å€¼      |
| --------------- | ------- |
| åœ°å›¾å¤§å°        | 800Ã—600 |
| ç½‘æ ¼ç²¾åº¦        | 32 åƒç´  |
| æ€»æ ¼å­æ•°        | 600     |
| ç›®æ ‡å¢™å¯†åº¦      | 10%     |
| é¢„æœŸå¢™æ•°        | ~60     |
| å°„çº¿æ•° / å‡ºç”Ÿç‚¹ | 24      |
| æœ€å¤§åå¼¹æ¬¡æ•°    | 4       |
| ç”Ÿæˆè€—æ—¶        | < 50ms  |
| å†…å­˜å ç”¨        | < 2MB   |

## å¯è°ƒå‚æ•°

åœ¨ `RicochetMapGenerator` æž„é€ æ—¶é…ç½®:

```typescript
const config: MapConfig = {
    width: 800,                    // åœ°å›¾å®½åº¦
    height: 600,                   // åœ°å›¾é«˜åº¦
    tileSize: 32,                  // ç½‘æ ¼å¤§å°
    seed: 12345,                   // ç§å­ï¼ˆä¸æŒ‡å®šåˆ™éšæœºï¼‰
    targetWallDensity: 0.10,       // å¢™ä½“ç›®æ ‡å¯†åº¦ (8% ~ 15% æŽ¨è)
    minWallsPerRegion: 2,          // æ¯åŒºå—æœ€å°‘å¢™æ•°
    maxWallsPerRegion: 8,          // æ¯åŒºå—æœ€å¤šå¢™æ•°
    spawnPoints: [...]             // å‡ºç”Ÿç‚¹åˆ—è¡¨
};
```

## è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹åœ°å›¾ç§å­
```
æ¸¸æˆç•Œé¢å·¦ä¸Šè§’æ˜¾ç¤º: "Seed: 12345"
```

### å¤çŽ°ç‰¹å®šåœ°å›¾
```typescript
// è®°å½•å¥½åœ°å›¾çš„ç§å­ï¼Œä¸‹æ¬¡ç”¨åŒç§å­ç”Ÿæˆ
mapManager.createMap(300, 500, 'wall-texture', 42);
```

### æŸ¥çœ‹è¦†ç›–çŽ‡
```
æŽ§åˆ¶å°è¾“å‡º:
  Spawn 0: 62.5% coverage
  Spawn 1: 65.2% coverage
  ...
  å¹³è¡¡æŒ‡æ•°: ä¼˜ç§€ / è‰¯å¥½ / ä¸€èˆ¬
```

### æŸ¥çœ‹ç›´çº¿ç§’æ€æ¶ˆé™¤
```
æŽ§åˆ¶å°è¾“å‡º:
  Eliminated 2 direct shot lines
```

## ä¼˜åŠ¿å¯¹æ¯”

### vs. çº¯éšæœºåœ°å›¾
```
çº¯éšæœº:
  âŒ ä¸å¯å¤çŽ°
  âŒ ç»å¸¸å‡ºçŽ°"åœ°ç‹±åœ°å½¢"
  âŒ å‡ºç”Ÿç‚¹ä¸å…¬å¹³

Ricochet:
  âœ… ç§å­å¯å¤çŽ°
  âœ… å‡è¡¡çš„ç©ºé—´åˆ†å¸ƒ
  âœ… æ‰€æœ‰å‡ºç”Ÿç‚¹å…¬å¹³
```

### vs. å›ºå®šåœ°å›¾
```
å›ºå®šåœ°å›¾:
  âŒ çŽ©å®¶å¾ˆå¿«è®°ä½
  âŒ å¯é‡å¤æ€§é«˜
  âŒ å¯¹é«˜æ‰‹é‡å¤

Ricochet:
  âœ… æ¯å±€ä¸åŒï¼ˆåŒç§å­ç›¸åŒï¼‰
  âœ… ä½†ä¿è¯å¹³è¡¡
  âœ… æ”¯æŒ"å¥½åœ°å›¾"åˆ†äº«
```

## æ‰©å±•æ–¹å‘

### æ·»åŠ æ–œå¢™ï¼ˆå¯é€‰ï¼‰
```typescript
// åœ¨çŸ­å¢™ç”Ÿæˆæ—¶æ·»åŠ  45Â° æ–œå¢™
const orientations = ['h', 'v', 'diagonal-left', 'diagonal-right'];
```

### å¤šéš¾åº¦ç­‰çº§
```typescript
const config = difficulty === 'easy' 
    ? { targetWallDensity: 0.06, ... }  // å°‘å¢™ï¼Œç©ºåœ°å¤š
    : { targetWallDensity: 0.14, ... }; // å¤šå¢™ï¼Œéšœç¢å¤š
```

### åŠ¨æ€ç§å­ç”Ÿæˆ
```typescript
// åŸºäºŽæ—¶é—´ã€çŽ©å®¶æ•°é‡ç”Ÿæˆç§å­
const seed = Math.floor(Date.now() / 60000) % 1000000;
// åŒä¸€åˆ†é’Ÿå†…æ‰€æœ‰çŽ©å®¶çŽ©ç›¸åŒåœ°å›¾
```

## æ€»ç»“

è¿™ä¸ªç®—æ³•ä½“çŽ°äº†"**å…ˆä¹±æ¥ï¼Œå†æ£€æŸ¥ï¼Œå†å¾®è°ƒ**"çš„è®¾è®¡å“²å­¦ï¼š

1. **å…ˆä¹±æ¥** - éšæœºç”Ÿæˆå¢™ä½“
2. **å†æ£€æŸ¥** - éªŒè¯å¹³è¡¡æ€§ï¼ˆè¦†ç›–çŽ‡ã€ç›´çº¿å°„å‡»ï¼‰
3. **å†å¾®è°ƒ** - æ’å…¥é®æŒ¡å¢™ï¼Œæ¶ˆé™¤ä¸å…¬å¹³

ç»“æžœæ˜¯ï¼šæ¸¸æˆåœ°å›¾æ—¢**çœ‹èµ·æ¥éšæœº**ï¼ˆæ¯å±€ä¸åŒï¼‰ï¼Œåˆ**ä¿è¯å…¬å¹³**ï¼ˆæ‰€æœ‰å‡ºç”Ÿç‚¹æœºä¼šå‡ç­‰ï¼‰ã€‚

**å…³é”®ä¼˜åŠ¿**:
- ðŸŽ¯ å…¬å¹³æ€§å¼º - ä¸å­˜åœ¨ç»å¯¹ä¼˜åŠ¿ä½ç½®
- ðŸŽ® è¶£å‘³æ€§é«˜ - æ¯å±€åœ°å½¢ä¸åŒï¼Œåå¼¹çŽ©æ³•å¤šå˜
- ðŸ“Š å¯è°ƒè¯• - ç§å­ç³»ç»Ÿè®©å¼‚å¸¸æƒ…å†µå¯å¤çŽ°
- âš¡ æ€§èƒ½ä¼˜ - çº¯JSå®žçŽ°ï¼Œ< 50msç”Ÿæˆ
- ðŸ”„ å¯å¤çŽ° - "å¥½åœ°å›¾"å¯åˆ†äº«ï¼ˆç§å­ï¼‰

---

**å®žçŽ°æ—¥æœŸ**: 2026-01-14  
**ç®—æ³•å¤æ‚åº¦**: O(walls) ç”Ÿæˆ + O(rays Ã— bounces) éªŒè¯  
**æŽ¨èæ¸¸æˆ**: å¦å…‹å¤§æˆ˜ã€å¼¹çƒå°„å‡»ç±»æ¸¸æˆ
